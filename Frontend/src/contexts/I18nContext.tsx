import { createContext, useContext, useMemo, useState, ReactNode } from 'react';

type Lang = 'en' | 'hi' | 'mr';

type Dict = Record<string, string>;

const dictionaries: Record<Lang, Dict> = {
  en: {
    app_title: 'HarvestIQ',
    app_subtitle: 'AI-Powered Crop Prediction for Indian Agriculture',
    scenario: 'Scenario',
    mock_api: 'Mock API',
    sign_out: 'Sign out',
    location_selection: 'Location Selection',
    crop_selection: 'Crop Selection',
    growing_season: 'Growing Season',
    selected_location: 'Selected Location:',
    choose_crop: 'Choose crop type',
    select_season: 'Select season',
    generate_forecast: 'Generate Forecast',
    forecast_dashboard: 'Forecast Dashboard',
    prediction_history: 'Prediction History',
    saved_predictions_subtitle: 'Your saved crop predictions and forecasts',
    select_to_generate_subtitle: 'Select location and crop to generate AI-powered forecast',
    view_history: 'View History',
    back_to_dashboard: 'Back to Dashboard',
    save_prediction: 'Save Prediction',
    weather_risk: 'Weather & Risk Assessment',
    temperature: 'Temperature',
    humidity: 'Humidity',
    trend_30d: '30-Day Weather Trend',
    next_7_days: 'Next 7 Days',
    yield_prediction: 'Yield Prediction',
    confidence: 'Confidence',
    vs_historical: 'vs. Historical Average',
    key_factors: 'Key Factors Impact',
    irrigation_schedule: 'Smart Irrigation Schedule',
    recommended_schedule: 'Recommended Schedule',
    water_savings: 'Estimated Water Savings',
    download_schedule: 'Download Schedule PDF',
    low_risk: 'Low Risk',
    moderate_risk: 'Moderate Risk',
    high_risk: 'High Risk',
    additional_insights: 'Additional Insights',
    satellite_insights: 'Satellite Insights',
    ndvi_image: 'NDVI Satellite Image',
    last_updated: 'Last Updated',
    ndvi_index: 'NDVI Index',
    coverage: 'Coverage',
    healthy: 'Healthy',
    excellent: 'Excellent',
    soil_conditions: 'Soil Conditions',
    soil_moisture: 'Soil Moisture',
    ph_level: 'pH Level',
    organic_matter: 'Organic Matter',
    soil_status_optimal: 'Soil Status: Optimal',
    soil_status_note: 'Good moisture retention and nutrient levels detected',
    data_sources_limits: 'Data Sources & Limitations',
    weather_data: 'Weather Data',
    live: 'Live',
    satellite_imagery: 'Satellite Imagery',
    two_days: '2 Days',
    historical_yields: 'Historical Yields',
    annual: 'Annual',
    soil_data: 'Soil Data',
    modeled: 'Modeled',
    model_performance: 'Model Performance',
    training_data: 'Training Data',
    // New: general/common
    view: 'View',
    simple: 'Simple',
    detailed: 'Detailed',
    water: 'Water',
    no_water: 'No water',
    next_action: 'Next:',
    do_label: 'Do',
    why_label: 'Why',
    how_much: 'How much',
    season_water_budget: 'Season water budget',
    farmer_tips: 'Farmer tips',
    tip_irrigate_early: 'Tip: Water early morning. If it rained >10 mm in last 24h, skip.',
    tip_list_1: 'Check soil moisture by hand (10–15 cm depth).',
    tip_list_2: 'Level the field to avoid water loss.',
    tip_list_3: 'Use mulching to keep moisture for longer.',
    tip_list_4: 'During hot days (>34°C), water a day earlier if plants wilt.',
    liters_per_ha_ac: '{{lha}} L/ha • {{lac}} L/acre',
    welcome_title: 'Welcome to HarvestIQ',
    welcome_prompt: 'Please select your district, crop, season, and sowing date in the left panel, then click Generate Forecast to see real-time weather, yield prediction, and your irrigation plan.',
    welcome_tip: 'Tip: Add your soil type and drainage to improve recommendations.',
    sowing_date: 'Sowing Date',
    select_taluka_placeholder: 'Select Taluka (coming soon)',
    full_map: 'Full Map',
    open_full_map_hint: 'Tap to open full map and choose your district/taluka',
    // New: toast strings
    generating_forecast_title: 'Generating Forecast',
    generating_forecast_description: 'Analyzing satellite data → Computing crop model → Optimizing irrigation',
    forecast_generated_success_title: 'Forecast Generated Successfully',
    forecast_generated_success_description: 'Yield prediction ready for {{crop}} in {{district}}',
    forecast_generation_failed_title: 'Forecast Generation Failed',
    forecast_generation_failed_description: 'Unable to generate forecast. Please try again.',
    weather_forecast_error_title: 'Weather Forecast Error',
    weather_forecast_error_desc: 'Failed to fetch 7-day weather forecast. Please try again later.',
  },
  hi: {
    app_title: 'HarvestIQ',
    app_subtitle: 'भारतीय कृषि के लिए एआई-सक्षम फसल पूर्वानुमान',
    scenario: 'परिदृश्य',
    mock_api: 'मॉक API',
    sign_out: 'साइन आउट',
    location_selection: 'स्थान चयन',
    crop_selection: 'फसल चयन',
    growing_season: 'फसल मौसम',
    selected_location: 'चयनित स्थान:',
    choose_crop: 'फसल प्रकार चुनें',
    select_season: 'मौसम चुनें',
    generate_forecast: 'पूर्वानुमान बनाएं',
    forecast_dashboard: 'पूर्वानुमान डैशबोर्ड',
    prediction_history: 'भविष्यवाणी इतिहास',
    saved_predictions_subtitle: 'आपकी सहेजी गई फसल भविष्यवाणियाँ',
    select_to_generate_subtitle: 'एआई पूर्वानुमान बनाने के लिए स्थान और फसल चुनें',
    view_history: 'इतिहास देखें',
    back_to_dashboard: 'डैशबोर्ड पर वापस',
    save_prediction: 'भविष्यवाणी सहेजें',
    weather_risk: 'मौसम और जोखिम आकलन',
    temperature: 'तापमान',
    humidity: 'नमी',
    trend_30d: '30-दिवसीय मौसम प्रवृत्ति',
    next_7_days: 'अगले 7 दिन',
    yield_prediction: 'उपज पूर्वानुमान',
    confidence: 'विश्वास',
    vs_historical: 'ऐतिहासिक औसत की तुलना',
    key_factors: 'मुख्य कारक प्रभाव',
    irrigation_schedule: 'स्मार्ट सिंचाई अनुसूची',
    recommended_schedule: 'अनुशंसित अनुसूची',
    water_savings: 'अनुमानित जल बचत',
    download_schedule: 'अनुसूची PDF डाउनलोड करें',
    low_risk: 'कम जोखिम',
    moderate_risk: 'मध्यम जोखिम',
    high_risk: 'उच्च जोखिम',
    additional_insights: 'अतिरिक्त अंतर्दृष्टि',
    satellite_insights: 'उपग्रह अंतर्दृष्टि',
    ndvi_image: 'NDVI उपग्रह चित्र',
    last_updated: 'अंतिम अद्यतन',
    ndvi_index: 'NDVI सूचकांक',
    coverage: 'कवरेज',
    healthy: 'स्वस्थ',
    excellent: 'उत्तम',
    soil_conditions: 'मृदा स्थिति',
    soil_moisture: 'मृदा आर्द्रता',
    ph_level: 'pH स्तर',
    organic_matter: 'कार्बनिक पदार्थ',
    soil_status_optimal: 'मृदा स्थिति: आदर्श',
    soil_status_note: 'अच्छी नमी धारण और पोषक स्तर पाए गए',
    data_sources_limits: 'डेटा स्रोत और सीमाएँ',
    weather_data: 'मौसम डेटा',
    live: 'लाइव',
    satellite_imagery: 'उपग्रह चित्र',
    two_days: '2 दिन',
    historical_yields: 'ऐतिहासिक उपज',
    annual: 'वार्षिक',
    soil_data: 'मृदा डेटा',
    modeled: 'मॉडल आधारित',
    model_performance: 'मॉडल प्रदर्शन',
    training_data: 'प्रशिक्षण डेटा',
    view: 'दृश्य',
    simple: 'सरल',
    detailed: 'विस्तृत',
    water: 'पानी दें',
    no_water: 'पानी न दें',
    next_action: 'अगला:',
    do_label: 'क्या करें',
    why_label: 'क्यों',
    how_much: 'कितना',
    season_water_budget: 'मौसम जल बजट',
    farmer_tips: 'किसान सुझाव',
    tip_irrigate_early: 'सुझाव: सुबह पानी दें। यदि पिछले 24 घंटे में >10 मिमी बारिश हुई हो तो छोड़ दें।',
    tip_list_1: 'हाथ से 10–15 सेमी गहराई पर मिट्टी की नमी जाँचें।',
    tip_list_2: 'पानी की बर्बादी रोकने के लिए खेत को समतल रखें।',
    tip_list_3: 'नमी बनाए रखने के लिए मल्चिंग का उपयोग करें।',
    tip_list_4: 'गर्म दिनों (>34°C) में यदि मुरझाहट दिखे तो एक दिन पहले पानी दें।',
    liters_per_ha_ac: '{{lha}} L/ha • {{lac}} L/acre',
    welcome_title: 'हार्वेस्टआईक्यू में आपका स्वागत है',
    welcome_prompt: 'बाएँ पैनल में जिला, फसल, मौसम और बोआई तिथि चुनें, फिर वास्तविक मौसम, उपज और सिंचाई योजना देखने के लिए पूर्वानुमान बनाएं।',
    welcome_tip: 'सुझाव: बेहतर सलाह के लिए मिट्टी का प्रकार और ड्रेनेज जोड़ें।',
    sowing_date: 'बोआई तिथि',
    select_taluka_placeholder: 'तालुका चुनें (जल्द आ रहा है)',
    full_map: 'फुल मैप',
    open_full_map_hint: 'पूर्ण मानचित्र खोलें और जिला/तालुका चुनें',
    generating_forecast_title: 'पूर्वानुमान तैयार हो रहा है',
    generating_forecast_description: 'उपग्रह विश्लेषण → मॉडल गणना → सिंचाई अनुकूलन',
    forecast_generated_success_title: 'पूर्वानुमान सफल',
    forecast_generated_success_description: '{{district}} में {{crop}} के लिए उपज तैयार',
    forecast_generation_failed_title: 'पूर्वानुमान विफल',
    forecast_generation_failed_description: 'पूर्वानुमान नहीं बन सका। कृपया पुनः प्रयास करें।',
    weather_forecast_error_title: 'मौसम त्रुटि',
    weather_forecast_error_desc: '7‑दिन का मौसम प्राप्त नहीं हो सका। बाद में प्रयास करें।',
  },
  mr: {
    app_title: 'HarvestIQ',
    app_subtitle: 'भारतीय कृषीसाठी एआय-आधारित पीक भाकीत',
    scenario: 'परिस्थिती',
    mock_api: 'मॉक API',
    sign_out: 'साइन आउट',
    location_selection: 'स्थान निवड',
    crop_selection: 'पीक निवड',
    growing_season: 'हंगाम',
    selected_location: 'निवडलेले स्थान:',
    choose_crop: 'पीक प्रकार निवडा',
    select_season: 'हंगाम निवडा',
    generate_forecast: 'भाकीत तयार करा',
    forecast_dashboard: 'भाकीत डॅशबोर्ड',
    prediction_history: 'भविष्यवाणी इतिहास',
    saved_predictions_subtitle: 'आपल्या जतन केलेल्या पीक भाकीती',
    select_to_generate_subtitle: 'एआय भाकीतासाठी ठिकाण आणि पीक निवडा',
    view_history: 'इतिहास पहा',
    back_to_dashboard: 'डॅशबोर्डवर परत',
    save_prediction: 'भविष्यवाणी जतन करा',
    weather_risk: 'हवामान आणि धोका मूल्यांकन',
    temperature: 'तापमान',
    humidity: 'आर्द्रता',
    trend_30d: '30-दिवसांची हवामान प्रवृत्ती',
    next_7_days: 'पुढील 7 दिवस',
    yield_prediction: 'उत्पन्न भाकीत',
    confidence: 'विश्वास',
    vs_historical: 'ऐतिहासिक सरासरीशी तुलना',
    key_factors: 'मुख्य घटक प्रभाव',
    irrigation_schedule: 'स्मार्ट सिंचन वेळापत्रक',
    recommended_schedule: 'शिफारस केलेले वेळापत्रक',
    water_savings: 'अंदाजित पाणी बचत',
    download_schedule: 'वेळापत्रक PDF डाउनलोड करा',
    low_risk: 'कमी धोका',
    moderate_risk: 'मध्यम धोका',
    high_risk: 'जास्त धोका',
    additional_insights: 'अतिरिक्त अंतर्दृष्टी',
    satellite_insights: 'उपग्रह अंतर्दृष्टी',
    ndvi_image: 'NDVI उपग्रह प्रतिमा',
    last_updated: 'शेवटचे अद्यतन',
    ndvi_index: 'NDVI निर्देशांक',
    coverage: 'कव्हरेज',
    healthy: 'निरोगी',
    excellent: 'उत्कृष्ट',
    soil_conditions: 'मातीची स्थिती',
    soil_moisture: 'मातीतील आर्द्रता',
    ph_level: 'pH स्तर',
    organic_matter: 'सेंद्रिय पदार्थ',
    soil_status_optimal: 'माती स्थिती: उत्कृष्ट',
    soil_status_note: 'चांगली आर्द्रता धारण क्षमता आणि पोषक स्तर आढळले',
    data_sources_limits: 'डेटा स्रोत आणि मर्यादा',
    weather_data: 'हवामान डेटा',
    live: 'लाइव्ह',
    satellite_imagery: 'उपग्रह प्रतिमा',
    two_days: '2 दिवस',
    historical_yields: 'इतिहासातील उत्पादन',
    annual: 'वार्षिक',
    soil_data: 'माती डेटा',
    modeled: 'मॉडेल',
    model_performance: 'मॉडेल कामगिरी',
    training_data: 'प्रशिक्षण डेटा',
    view: 'दृश्य',
    simple: 'साधे',
    detailed: 'तपशील',
    water: 'पाणी द्या',
    no_water: 'पाणी देऊ नका',
    next_action: 'पुढील:',
    do_label: 'करा',
    why_label: 'का',
    how_much: 'किती',
    season_water_budget: 'हंगामी पाणी बजेट',
    farmer_tips: 'शेतकरी टिप्स',
    tip_irrigate_early: 'टीप: सकाळी पाणी द्या. मागील 24 तासांत >10 मिमी पाऊस झाला असेल तर टाळा.',
    tip_list_1: 'हाताने 10–15 सेमी खोलीवर मातीतील आर्द्रता तपासा.',
    tip_list_2: 'पाण्याचा अपव्यय टाळण्यासाठी शेत समतल ठेवा.',
    tip_list_3: 'आर्द्रता टिकवण्यासाठी मल्चिंग वापरा.',
    tip_list_4: 'उष्ण दिवस (>34°C) असल्यास आणि वाळलेले दिसल्यास एक दिवस आधी पाणी द्या.',
    liters_per_ha_ac: '{{lha}} L/ha • {{lac}} L/acre',
    welcome_title: 'HarvestIQ मध्ये आपले स्वागत',
    welcome_prompt: 'डाव्या बाजूला जिल्हा, पीक, हंगाम आणि पेरणी तारीख निवडा आणि नंतर भाकीत तयार करा.',
    welcome_tip: 'टीप: चांगल्या सल्ल्यासाठी मातीचा प्रकार आणि ड्रेनेज भरा.',
    sowing_date: 'पेरणी तारीख',
    select_taluka_placeholder: 'तालुका निवडा (लवकरच)',
    full_map: 'पूर्ण नकाशा',
    open_full_map_hint: 'पूर्ण नकाशा उघडा आणि जिल्हा/तालुका निवडा',
    generating_forecast_title: 'भाकीत तयार होत आहे',
    generating_forecast_description: 'उपग्रह विश्लेषण → मॉडेल गणना → सिंचन अनुकूलन',
    forecast_generated_success_title: 'भाकीत तयार',
    forecast_generated_success_description: '{{district}} येथे {{crop}} साठी भाकीत तयार',
    forecast_generation_failed_title: 'भाकीत अयशस्वी',
    forecast_generation_failed_description: 'भाकीत तयार झाले नाही. कृपया पुन्हा प्रयत्न करा.',
    weather_forecast_error_title: 'हवामान त्रुटी',
    weather_forecast_error_desc: '7‑दिवसांचे हवामान मिळू शकले नाही. नंतर प्रयत्न करा.',
  },
};

interface I18nContextType {
  lang: Lang;
  setLang: (l: Lang) => void;
  t: (key: string) => string;
}

const I18nContext = createContext<I18nContextType | undefined>(undefined);

export const I18nProvider = ({ children }: { children: ReactNode }) => {
  const [lang, setLang] = useState<Lang>('en');
  const t = useMemo(() => (key: string) => dictionaries[lang][key] ?? dictionaries.en[key] ?? key, [lang]);
  const value = useMemo(() => ({ lang, setLang, t }), [lang, t]);
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
};

export const useI18n = (): I18nContextType => {
  const ctx = useContext(I18nContext);
  if (!ctx) {
    // Fallback to English if provider is not mounted to avoid runtime crashes
    return {
      lang: 'en',
      setLang: () => {},
      t: (key: string) => dictionaries.en[key] ?? key,
    } as I18nContextType;
  }
  return ctx;
};


